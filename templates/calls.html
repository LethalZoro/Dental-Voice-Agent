{% extends "base.html" %}
{% block title %}Call History{% endblock %}

{% block head %}
<style>
    /* Remove hover effect on table rows */
    .table tr {
        cursor: default;
    }
    
    /* Keep pointer cursor only for buttons and links */
    .table a, .table button {
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Call History</h5>
                <div>
                    <button id="refreshListBtn" class="btn btn-outline-secondary btn-sm me-2">
                        <i class="fas fa-sync-alt me-1"></i> Refresh List
                    </button>
                    <a href="/" class="btn btn-primary btn-sm">
                        <i class="fas fa-phone-alt me-1"></i> New Call
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if calls %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Call ID</th>
                                <th>Phone Number</th>
                                <th>Date & Time</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for call in calls %}
                            <tr class="call-row" data-id="{{ call.id }}">
                                <td>{{ call.id }}</td>
                                <td>{{ call.phone_number }}</td>
                                <td>{{ call.timestamp }}</td>
                                <td>
                                    {% if call.status == 'scheduled' %}
                                    <span class="badge bg-secondary">Scheduled</span>
                                    {% elif call.status == 'in_progress' %}
                                    <span class="badge bg-warning">In Progress</span>
                                    {% elif call.status == 'completed' %}
                                    <span class="badge bg-success">Completed</span>
                                    {% elif call.status == 'failed' %}
                                    <span class="badge bg-danger">Failed</span>
                                    {% else %}
                                    <span class="badge bg-info">{{ call.status|capitalize }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="/calls/{{ call.id }}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i> View Details
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center p-5">
                    <i class="fas fa-phone-slash fa-3x mb-3 text-muted"></i>
                    <h5>No calls found</h5>
                    <p class="text-muted">Make your first call to see it in the history.</p>
                    <a href="/" class="btn btn-primary mt-2">
                        <i class="fas fa-phone-alt me-2"></i>Make a Call
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Remove clickable row behavior - only use the "View Details" button
        
        // Refresh list button
        document.getElementById('refreshListBtn').addEventListener('click', function() {
            window.location.reload();
        });
        
        // Add auto-refresh functionality for calls page if there are in-progress or scheduled calls
        const inProgressBadges = document.querySelectorAll('.badge.bg-warning, .badge.bg-secondary');
        if (inProgressBadges.length > 0) {
            // Create auto-refresh notification
            const notification = document.createElement('div');
            notification.className = 'alert alert-info mt-3';
            notification.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-sync fa-spin me-2"></i> Auto-refreshing in <span id="pageCountdown">30</span> seconds</span>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="pageAutoRefresh" checked>
                        <label class="form-check-label" for="pageAutoRefresh">Auto-refresh</label>
                    </div>
                </div>
            `;
            
            document.querySelector('.card-body').prepend(notification);
            
            // Set up countdown
            let countdown = 30;
            let timer = setInterval(() => {
                if (!document.getElementById('pageAutoRefresh').checked) {
                    document.getElementById('pageCountdown').parentElement.innerHTML = 
                        '<i class="fas fa-pause me-2"></i> Auto-refresh paused';
                    return;
                }
                
                countdown--;
                document.getElementById('pageCountdown').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    window.location.reload();
                }
            }, 1000);
            
            // Toggle functionality
            document.getElementById('pageAutoRefresh').addEventListener('change', function() {
                if (this.checked) {
                    countdown = 30;
                    document.getElementById('pageCountdown').textContent = countdown;
                    document.getElementById('pageCountdown').parentElement.innerHTML = 
                        `<i class="fas fa-sync fa-spin me-2"></i> Auto-refreshing in <span id="pageCountdown">${countdown}</span> seconds`;
                } else {
                    document.getElementById('pageCountdown').parentElement.innerHTML = 
                        '<i class="fas fa-pause me-2"></i> Auto-refresh paused';
                }
            });
        }
    });
</script>
{% endblock %}
